<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用powerdns搭建自己安全的域名解析服务 - 后花园</title><link rel=apple-touch-icon href=https://windyboy.github.io/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon href=https://windyboy.github.io/images/favicons/favicon-32x32.png sizes=32x32 type=image/png><link rel=icon href=https://windyboy.github.io/images/favicons/favicon-16x16.png sizes=16x16 type=image/png><link rel=manifest href=https://windyboy.github.io/images/favicons/manifest.json><link rel=icon href=https://windyboy.github.io/images/favicons/favicon.ico><meta name=keywords content><meta name=description content><meta itemprop=name content="使用powerdns搭建自己安全的域名解析服务"><meta itemprop=description content="概况 解析服务需要提供两个独立的IP，一主(master)一从(slave)提供解析服务 两个NS服务器IP地址要注册到域名注册商的服务里，解决"><meta itemprop=datePublished content="2019-02-14T10:00:00+08:00"><meta itemprop=dateModified content="2021-07-23T00:00:00+00:00"><meta itemprop=wordCount content="1978"><meta itemprop=keywords content="dns,dnssec,powerdns,postgresql,authoritative,cloudxns,powerdns-admin,master,slave,dnssec,"><meta property="og:title" content="使用powerdns搭建自己安全的域名解析服务"><meta property="og:description" content="概况 解析服务需要提供两个独立的IP，一主(master)一从(slave)提供解析服务 两个NS服务器IP地址要注册到域名注册商的服务里，解决"><meta property="og:type" content="article"><meta property="og:url" content="https://windyboy.github.io/zh-cn/posts/tech/setup-powerdns-authoritative-with-dnssec/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-14T10:00:00+08:00"><meta property="article:modified_time" content="2021-07-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用powerdns搭建自己安全的域名解析服务"><meta name=twitter:description content="概况 解析服务需要提供两个独立的IP，一主(master)一从(slave)提供解析服务 两个NS服务器IP地址要注册到域名注册商的服务里，解决"><meta name=twitter:site content="@windysylph"><meta data-name=palette content="blue"><link rel=stylesheet href=https://windyboy.github.io/css/bundle.min.ed6746900a6c69ec4ea706b8bfb92337140961a4b3c17129fb02128bb1abd6a3.css integrity="sha256-7WdGkApsaexOpwa4v7kjNxQJYaSzwXEp+wISi7Gr1qM=" crossorigin=anonymous><script src=https://windyboy.github.io/js/bundle.min.eb746ce764bb30921550268b5c5fbfda4b11c1925a439d777ba45e3a1962eddb.js integrity="sha256-63Rs52S7MJIVUCaLXF+/2ksRwZJaQ513e6ReOhli7ds=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-V1359E3SKN","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><header><nav class="navbar navbar-expand-xl fixed-top"><div class=container><a class=navbar-brand href=https://windyboy.github.io/zh-cn/><img class=logo alt=Logo src=https://windyboy.github.io/images/logo.webp loading=lazy>backyard</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action=https://windyboy.github.io/zh-cn/search><div class="input-group input-group-sm"><button class="btn btn-search disabled position-absolute left-0" type=submit><i class="fas fa-fw fa-search"></i></button>
<input class="form-control rounded-pill" id=searchQuery name=q type=search aria-label=Search></div></form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class=nav-item><a class=nav-link href=https://windyboy.github.io/zh-cn/archives/><i class="fas fa-fw fa-file-archive"></i>归档</a></li><li class=nav-item><a class=nav-link href=https://windyboy.github.io/zh-cn/zh-cn/categories/><i class="fas fa-fw fa-folder"></i>分类</a></li><li class=nav-item><a class=nav-link href=https://windyboy.github.io/zh-cn/zh-cn/tags/><i class="fas fa-fw fa-tags"></i>标签</a></li><li class=nav-item><a class=nav-link href=https://windyboy.github.io/zh-cn/zh-cn/series/><i class="fas fa-fw fa-columns"></i>专栏</a></li><li class="nav-item dropdown"><a class=nav-link id=navbarDropdown-dropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-chevron-circle-down"></i>下拉菜单</a><ul class=dropdown-menu aria-labelledby=navbarDropdown-dropdown><li><a class=dropdown-item href=https://github.com/razonyang/hugo-theme-bootstrap target=_blank>Github</a></li></ul></li><li class=nav-item><a class=nav-link data-bs-toggle=offcanvas href=#offcanvasSettings role=button aria-controls=offcanvasSettings><i class="fas fa-fw fa-sliders-h"></i> 设置</a></li><div class="offcanvas offcanvas-end surface h-100" tabindex=-1 id=offcanvasSettings aria-labelledby=offcanvasSettingsLabel><div class=offcanvas-header><h5 class=offcanvas-title w id=offcanvasSettingsLabel><i class="fas fa-fw fa-sliders-h"></i> 设置</h5><a role=button data-bs-dismiss=offcanvas aria-label=Close><span class="fas fa-2x fa-fw fa-times"></span></a></div><div class=offcanvas-body><section class=setting><form class=row><div class=col-auto><label><i class="fas fa-fw fa-adjust"></i> 模式</label></div><div class="col-auto ms-auto"><div class="form-check form-switch"><input class=form-check-input type=checkbox id=modeSwitcher></div></div></form></section><section class=setting><form class=row><div class=col-auto><label><i class="fas fa-fw fa-language"></i> 语言</label></div><div class="col-auto ms-auto"><select class="form-select form-select-sm language-picker" aria-label="Language dropdown" onchange="window.location=this.value"><option value=https://windyboy.github.io/zh-cn/ selected>简体中文</option><option value=https://windyboy.github.io/zh-tw/></option></select></div></form></section><section class=setting><form class="font-size-switcher-form row"><div class=col-auto><label for=fontSize class=form-label><i class="fas fa-fw fa-font"></i> 字体大小</label></div><div class="col-auto ms-auto"><input type=range class=form-range min=-2 max=2 id=fontSize></div></form></section><section class="setting palettes"><form class=row><div class=col-auto><label><i class="fas fa-fw fa-palette"></i> 配色</label></div><div class="col-auto ms-auto"><span id=btnPalette class="btn btn-sm"><i class="fas fa-eye-dropper"></i></span></div></form><div class="container mt-2 visually-hidden" id=palettePicker><div class=btn-group><button type=button id=palette-blue title=蓝色 class="btn btn-sm palette bg-blue d-flex align-items-center justify-content-center">
</button><button type=button id=palette-blue-gray title=蓝灰色 class="btn btn-sm palette bg-blue-gray d-flex align-items-center justify-content-center">
</button><button type=button id=palette-brown title=棕色 class="btn btn-sm palette bg-brown d-flex align-items-center justify-content-center">
</button><button type=button id=palette-cyan title=青色 class="btn btn-sm palette bg-cyan d-flex align-items-center justify-content-center">
</button><button type=button id=palette-green title=绿色 class="btn btn-sm palette bg-green d-flex align-items-center justify-content-center">
</button><button type=button id=palette-indigo title=靛青色 class="btn btn-sm palette bg-indigo d-flex align-items-center justify-content-center">
</button><button type=button id=palette-orange title=橙色 class="btn btn-sm palette bg-orange d-flex align-items-center justify-content-center">
</button><button type=button id=palette-pink title=粉色 class="btn btn-sm palette bg-pink d-flex align-items-center justify-content-center">
</button><button type=button id=palette-purple title=紫色 class="btn btn-sm palette bg-purple d-flex align-items-center justify-content-center">
</button><button type=button id=palette-red title=红色 class="btn btn-sm palette bg-red d-flex align-items-center justify-content-center">
</button><button type=button id=palette-teal title=蓝绿色 class="btn btn-sm palette bg-teal d-flex align-items-center justify-content-center">
</button><button type=button id=palette-yellow title=黄色 class="btn btn-sm palette bg-yellow d-flex align-items-center justify-content-center"></button></button></div></div></section></div></div></ul></div></div></nav></header><main role=main class=container><div class="row content"><div class=col-lg-8><div class=container><nav class=row aria-label=breadcrumb><ol class="breadcrumb surface"><li class=breadcrumb-item><a href=https://windyboy.github.io/zh-cn/>主页</a></li><li class=breadcrumb-item><a href=https://windyboy.github.io/zh-cn/posts/>文章</a></li><li class=breadcrumb-item><a href=https://windyboy.github.io/zh-cn/posts/tech/>技术</a></li><li class="breadcrumb-item active">使用powerdns搭建自己安全的域名解析服务</li></ol></nav><article class="post row surface"><div class=post-toolbox><div class="col-12 d-none d-lg-block"><a id=sidebarToggler class="fas fa-fw fa-2x fa-expand-alt" role=button></a></div></div><h1 class="post-title my-3">使用powerdns搭建自己安全的域名解析服务</h1><div class="post-meta mb-3"><span class="post-date me-2"><i class="fas fa-fw fa-calendar-alt"></i>2019-02-14</span>
<span class="post-reading-time me-2"><i class="fas fa-fw fa-coffee"></i>4 分钟阅读</span>
<a href=https://windyboy.github.io/zh-cn/categories/%E6%8A%80%E6%9C%AF/ class=post-taxonomy>#技术</a><a href=https://windyboy.github.io/zh-cn/tags/dns/ class=post-taxonomy>#dns</a><a href=https://windyboy.github.io/zh-cn/tags/powerdns/ class=post-taxonomy>#powerdns</a><a href=https://windyboy.github.io/zh-cn/tags/postgresql/ class=post-taxonomy>#postgresql</a><a href=https://windyboy.github.io/zh-cn/tags/authoritative/ class=post-taxonomy>#authoritative</a><a href=https://windyboy.github.io/zh-cn/tags/cloudxns/ class=post-taxonomy>#cloudxns</a><a href=https://windyboy.github.io/zh-cn/tags/powerdns-admin/ class=post-taxonomy>#powerdns-admin</a><a href=https://windyboy.github.io/zh-cn/tags/master/ class=post-taxonomy>#master</a><a href=https://windyboy.github.io/zh-cn/tags/slave/ class=post-taxonomy>#slave</a><a href=https://windyboy.github.io/zh-cn/tags/dnssec/ class=post-taxonomy>#dnssec</a></div><a id=btnTOC class="fas fa-fw fa-2x fa-list-alt position-fixed" data-bs-toggle=offcanvas href=#offcanvasTOC aria-controls=offcanvasTOC role=button></a><div class="offcanvas offcanvas-end surface" tabindex=-1 id=offcanvasTOC aria-labelledby=offcanvasTOCLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasTOCLabel>目录</h5><a role=button data-bs-dismiss=offcanvas aria-label=Close><span class="fas fa-2x fa-fw fa-times"></span></a></div><div class=offcanvas-body><nav id=TableOfContents><ul><li><a href=#概况>概况</a></li><li><a href=#安装软件>安装软件</a><ul><li><a href=#从官方的repohttpsrepopowerdnscom安装authoritative服务软件>从官方的<a href=https://repo.powerdns.com/>repo</a>安装authoritative服务软件</a></li><li><a href=#安装数据库>安装数据库</a></li><li><a href=#安装-powerdns-admin>安装 <a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web>Powerdns-Admin</a></a></li></ul></li><li><a href=#配置服务>配置服务</a><ul><li><a href=#配置环境>配置环境</a></li><li><a href=#master-ns1somehost>Master ns1.some.host</a></li><li><a href=#slave-ns2somehost>Slave ns2.some.host</a></li><li><a href=#使用powerdns-admin界面创建域名>使用<a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web>powerdns-admin</a>界面创建域名</a></li><li><a href=#创建dnssec记录>创建DNSSEC记录</a></li></ul></li><li><a href=#注册解析服务>注册解析服务</a></li><li><a href=#检验>检验</a></li><li><a href=#参考资料>参考资料</a></li><li><a href=#vps-推荐>VPS 推荐</a></li></ul></nav></div></div><div class="post-content mb-3"><h2 id=概况>概况</h2><ul><li>解析服务需要提供两个独立的IP，一主(master)一从(slave)提供解析服务</li><li>两个NS服务器IP地址要注册到域名注册商的服务里，解决先有鸡还是先有蛋的问题</li><li>DNSSEC的key也要注册到注册商</li><li>安装 <a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web target=_blank>powerdns-admin</a>
管理域名</li></ul><h2 id=安装软件>安装软件</h2><p><strong>两台服务器都安装相同的软件, authoritative 和 database</strong></p><h3 id=从官方的repohttpsrepopowerdnscom安装authoritative服务软件>从官方的<a href=https://repo.powerdns.com/ target=_blank>repo</a>
安装authoritative服务软件</h3><ul><li>创建pdns的源</li></ul><pre tabindex=0><code># vim /etc/apt/sources.list.d/pdns.list

deb [arch=amd64] http://repo.powerdns.com/debian buster-auth-master main
</code></pre><ul><li>屏蔽debian自带的pdns</li></ul><pre tabindex=0><code># vim /etc/apt/preferences.d/pdns 
Package: pdns-*
Pin: origin repo.powerdns.com
Pin-Priority: 600
</code></pre><ul><li>引入官方的key</li></ul><pre tabindex=0><code># curl https://repo.powerdns.com/CBC8B383-pub.asc | sudo apt-key add -
</code></pre><ul><li>安装服务器软件</li></ul><pre tabindex=0><code># apt-get update
# apt-get install pdns-server pdns-backend-pgsql
</code></pre><p><em><strong>其他的系统可以到 <a href=https://repo.powerdns.com/ target=_blank>https://repo.powerdns.com/</a>
参考响应的安装指引</strong></em></p><h3 id=安装数据库>安装数据库</h3><ul><li>安装postgresql</li></ul><pre tabindex=0><code># apt install postgresql postgresql-client
</code></pre><ul><li>初始化数据库账号</li></ul><pre tabindex=0><code># sudo -u postgres psql
postgres=# create user pdns with password &#39;mypdnspassword&#39;;
postgres=# create database pdns owner pdns;
postgres=# grant all privileges on database pdns to pdns;
postgres=# \q
</code></pre><ul><li>安装powerdns的backend, 创建数据库</li></ul><pre tabindex=0><code># apt install pdns-backend-pgsql
# psql -U pdns -d pdns -h 127.0.0.1 -p 5432
pdns=&gt; \i /usr/share/doc/pdns-backend-pgsql/schema.pgsql.sql
</code></pre><ul><li>建立主从数据的复制</li></ul><p>在从(Slave)服务器上执行</p><pre tabindex=0><code># psql -U pdns -d pdns -h 127.0.0.1 -p 5432

pdns=&gt; insert into supermasters (ip, nameserver, account) values (&#39;x.x.x.x1&#39;, &#39;ns2.some.host&#39;,&#39;admin&#39;);
pdns=&gt; insert into domains (name, master, type) values (&#39;some.host&#39;, &#39;x.x.x.x1&#39;, &#39;SLAVE&#39;);
pdns=&gt;\q

# systemctl restart pdns
</code></pre><p>x.x.x.x1 是主服务器的IP地址</p><h3 id=安装-powerdns-admin>安装 <a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web target=_blank>Powerdns-Admin</a></h3><p><strong>管理界面只安装在主服务器上</strong></p><ul><li>安装基础设施</li></ul><pre tabindex=0><code># apt install -y libmysqlclient-dev libsasl2-dev libldap2-dev libssl-dev libxml2-dev libxslt1-dev libxmlsec1-dev libffi-dev pkg-config apt-transport-https virtualenv build-essential
# curl -sL https://deb.nodesource.com/setup_10.x | bash -
# apt-get install -y nodejs
# curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
# echo &#34;deb https://dl.yarnpkg.com/debian/ stable main&#34; | tee /etc/apt/sources.list.d/yarn.list
# apt update -y
# apt install -y yarn
# apt install nginx
</code></pre><ul><li>创建数据库</li></ul><pre tabindex=0><code>$ sudo su - postgres
$ createuser powerdnsadmin
$ createdb powerdnsadmindb
$ psql
postgres=# alter user powerdnsadmin with encrypted password &#39;powerdnsadmin&#39;;
postgres=# grant all privileges on database powerdnsadmindb to powerdnsadmin;
</code></pre><ul><li>安装软件</li></ul><pre tabindex=0><code># git clone https://github.com/ngoduykhanh/PowerDNS-Admin.git /opt/web/powerdns-admin
# cd /opt/web/powerdns-admin
# virtualenv -p python3 flask
# source ./flask/bin/activate
# pip install -r requirements.txt
# pip install psycopg2
# cp config_template.py config.py
</code></pre><ul><li>数据库配置</li></ul><pre tabindex=0><code># vi config.py
SQLALCHEMY_DATABASE_URI = &#39;postgresql://powerdnsadmin:powerdnsadmin@127.0.0.1/powerdnsadmindb&#39;
</code></pre><ul><li>运行</li></ul><pre tabindex=0><code># export FLASK_APP=app/__init__.py
# flask db upgrade
# yarn install --pure-lockfile
# flask assets build
# ./run.py
</code></pre><ul><li>安装服务</li></ul><pre tabindex=0><code># groupadd powerdnsadmin
# useradd --system --user-group powerdnsadmin
# vim /etc/systemd/system/powerdns-admin.service

[Unit]
Description=PowerDNS-Admin
After=network.target

[Service]
Type=simple
User=powerdnsadmin
Group=powerdnsadmin
ExecStart=/opt/web/powerdns-admin/flask/bin/gunicorn --workers 2 --bind unix:/opt/web/powerdns-admin/powerdns-admin.sock app:app
WorkingDirectory=/opt/web/powerdns-admin
Restart=always

[Install]
WantedBy=multi-user.target

# systemctl daemon-reload
# systemctl start powerdns-admin
# systemctl enable powerdns-admin
</code></pre><ul><li>配置反向代理</li></ul><pre tabindex=0><code># vim /etc/nginx/sites-available/pdns

server {
    server_name pdns.some.local ;
    listen 80;
      index                     index.html index.htm index.php;
  root                      /opt/web/powerdns-admin;
  access_log                /var/log/nginx/powerdns-admin.local.access.log combined;
  error_log                 /var/log/nginx/powerdns-admin.local.error.log;

  client_max_body_size              10m;
  client_body_buffer_size           128k;
  proxy_redirect                    off;
  proxy_connect_timeout             90;
  proxy_send_timeout                90;
  proxy_read_timeout                90;
  proxy_buffers                     32 4k;
  proxy_buffer_size                 8k;
  proxy_set_header                  Host $host;
  proxy_set_header                  X-Real-IP $remote_addr;
  proxy_set_header                  X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_headers_hash_bucket_size    64;

  location ~ ^/static/  {
    include  /etc/nginx/mime.types;
    root /opt/web/powerdns-admin/app;

    location ~*  \.(jpg|jpeg|png|gif)$ {
      expires 365d;
    }

    location ~* ^.+.(css|js)$ {
      expires 7d;
    }
  }

  location / {
    proxy_pass            http://unix:/opt/web/powerdns-admin/powerdns-admin.sock;
    proxy_read_timeout    120;
    proxy_connect_timeout 120;
    proxy_redirect        off;
  }
}

# ln -s /etc/nginx/sites-available/pdns /etc/nginx/sites-enabled/pdns
# nginx -t
# systemctl restart nginx
</code></pre><ul><li>连接到PowerDNS API</li></ul><pre tabindex=0><code>打开网页 pdns.some.host ， 注册新用户并登陆

打开 API 设置页面，连接到主服务器
http://pdns.some.host/admin/setting/pdns

PDNS API URL: http://localhost:8081
PDNS API KEY: somekey
</code></pre><h2 id=配置服务>配置服务</h2><h3 id=配置环境>配置环境</h3><ul><li>配置host文件，强制解析 ns1, ns2</li></ul><pre tabindex=0><code># vim /etc/hosts
x.x.x.x1   ns1.some.host
x.x.x.x2   ns2.some.host
</code></pre><p>两台解析服务器都使用相同配置</p><ul><li>分别在两台主机验证</li></ul><pre tabindex=0><code># ping ns1.some.host
# ping ns2.some.host
</code></pre><h3 id=master-ns1somehost>Master ns1.some.host</h3><pre tabindex=0><code># vim /etc/powerdns/pdns.conf

config-dir=/etc/powerdns
setuid=pdns
setgid=pdns
master=yes
slave=no
allow-axfr-ips=x.x.x.x2/32
default-soa-name=ns1.some.host
dnsupdate=yes
daemon=yes
disable-axfr=no
guardian=yes
local-address=0.0.0.0
local-port=53
log-dns-details=no
log-dns-queries=no
loglevel=9
socket-dir=/var/run
version-string=powerdns
# only 4.0
webserver=yes
api=yes
api-key=somekey
include-dir=/etc/powerdns/pdns.d
launch=
</code></pre><p>其中x.x.x.x2为从服务器ns2.some.host的ip地址</p><h3 id=slave-ns2somehost>Slave ns2.some.host</h3><pre tabindex=0><code># vim /etc/powerdns/pdns.conf

config-dir=/etc/powerdns
setuid=pdns
setgid=pdns
master=no
slave=yes
daemon=yes
disable-axfr=yes
guardian=yes
local-address=0.0.0.0
local-port=53
log-dns-details=no
log-dns-queries=no
loglevel=9
slave-cycle-interval=60
socket-dir=/var/run
version-string=powerdns
include-dir=/etc/powerdns/pdns.d
launch=
</code></pre><h3 id=使用powerdns-admin界面创建域名>使用<a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web target=_blank>powerdns-admin</a>
界面创建域名</h3><p>登录到<a href=https://github.com/ngoduykhanh/PowerDNS-Admin title=web target=_blank>powerdns-admin</a>
的网页， 选择New Domain，进入新建向导的网页, 在 name 里输入域名 some.host, type 设置为 master, SOA-EDIT-API 默认 DEFAULT</p><p>点击Dashboard 回到主界面, 从列表中选择刚才创建的域名 some.host</p><pre tabindex=0><code>some.host	SOA	ns1.some.host hostmaster.some.host 2017101100 28800 7200 604800 86400
</code></pre><p>第一条ns1.some.host为主服务器域名</p><p>第二条hostmaster.some.host实际上是邮件地址，系统替换第一个&rsquo;.&lsquo;为&rsquo;@&rsquo;, 这里代表的地址是hostmaster@some.host，具体可以根据实际情况写自己的邮箱地址</p><p>创建成功以后可以用dig命令核实一下</p><pre tabindex=0><code>dig some.host soa @localhost
;; ANSWER SECTION:
some.host.              3600    IN      SOA     ns1.some.host. postmaster.some.host. 2017101106 28800 7200 604800 86400
</code></pre><h3 id=创建dnssec记录>创建DNSSEC记录</h3><ul><li>使用pdnsutil创建DNSSEC</li></ul><pre tabindex=0><code>pdnsutil secure-zone some.host

Securing zone with default key size
Adding CSK (257) with algorithm ecdsa256
Zone some.host secured
gpgsql Connection successful. Connected to database &#39;pdns&#39; on &#39;localhost&#39;.
Adding NSEC ordering information
</code></pre><ul><li>查看已经生成的key</li></ul><pre tabindex=0><code>pdnsutil show-zone some.host

This is a Master zone
Last SOA serial number we notified: 2017101100 == 2017101100 (serial in the database)
Metadata items: None
Zone has NSEC semantics
keys:
ID = 10 (CSK), flags = 257, tag = 59581, algo = 13, bits = 256    Active ( ECDSAP256SHA256 )
CSK DNSKEY = some.host. IN DNSKEY 257 3 13 PQ29wza3majnpUQ+21oEkQjfpyN3dMnTy0StcnNX7YeuRRkOeddqPpFMDoeovZcpQGV0BxduvFn/Q2DW5WXp8w== ; ( ECDSAP256SHA256 )
DS = some.host. IN DS 59581 13 1 7908b7585027f7a262d664c7ee07ae5c5733d44e ; ( SHA1 digest )
DS = some.host. IN DS 59581 13 2 cfc9006e02d2a02448cd8cdde7fcb8e840703883b166685f37db5225ad902a88 ; ( SHA256 digest )
DS = some.host. IN DS 59581 13 3 67099daf0ecaf3e99c1c5dcce132c66dc201d27d2f1baade0fecbbbaa2c6b423 ; ( GOST R 34.11-94 digest )
DS = some.host. IN DS 59581 13 4 53062fef193fae2564f9f2441cb821ae3b55c92afac5790ae70cb8e9359313e0a4c879a09c44c9cb98ed68100cf2e938 ; ( SHA-384 digest )
</code></pre><ul><li>在主服务器创建 TSIG Key</li></ul><pre tabindex=0><code># pdnsutil generate-tsig-key mykey hmac-sha512

# pdnsutil activate-tsig-key some.host mykey
</code></pre><ul><li>把相关信息推送到从服务器</li></ul><p>在主服务器上执行</p><pre tabindex=0><code># pdnsutil increase-serial some.host

# pdns_control notify some.host
</code></pre><p>检查从服务器的日志，看到</p><pre tabindex=0><code>Received NOTIFY for some.host
...

AXFR done for &#39;some.host&#39;
</code></pre><h2 id=注册解析服务>注册解析服务</h2><ul><li>注册nameserver的IP地址</li></ul><p>打开域名注册商的网页，我这里以<a href=https://www.namesilo.com title=namesilo target=_blank>namesilo</a>
为例</p><p>点击domain manager, 再点击已经注册成功的域名(some.host)，进入域名管理界面</p><p>在NameServers部分，点击View/Manage Registered NameServers， 进入注册域名解析服务器页面</p><p>点击 REGISTER NEW NAMESERVER 按钮，分别加入ns1, ns2的IP地址</p><ul><li>注册DNSSEC</li></ul><p>回到之前域名管理的页面， 点击DS Records (DNSSEC):后面的Update连接</p><p>进入注册Key的界面， 相关信息在之前 pdnsutil show-zone some.host 的部分已经列出</p><pre tabindex=0><code>DS = some.host. IN DS 59581 13 1 7908b7585027f7a262d664c7ee07ae5c5733d44e ; ( SHA1 digest )
</code></pre><p>Digest = 7908b7585027f7a262d664c7ee07ae5c5733d44e</p><p>Key Tag = 59581</p><p>Digest Type = 1</p><p>Algorithm = 13</p><h2 id=检验>检验</h2><ul><li>检查域名是否已在全球生效</li></ul><p>打开网站： <a href=https://dnschecker.org/ target=_blank>https://dnschecker.org/</a></p><p>输入域名 some.host , 检查各地的解析情况</p><ul><li>使用dig在本地服务器检验DNSSEC</li></ul><pre tabindex=0><code># dig some.host +dnssec +multi @localhost

;; AUTHORITY SECTION:
some.host.              86400 IN SOA ns1.some.host. hostmaster.some.host. (
                                2017101100 ; serial
                                28800      ; refresh (8 hours)
                                7200       ; retry (2 hours)
                                604800     ; expire (1 week)
                                86400      ; minimum (1 day)
                                )
some.host.              86400 IN RRSIG SOA 13 2 86400 (
                                20171019000000 20170928000000 59581 some.host.
                                UyrOyITKMWhtf2n8lN3ZhtxaAGSMFQI9Qndd49D2/Pe5
                                wWLileK3RVPFRGlXflQfFDfQ6wb7R5+aBCls6qkmIA== )
some.host.              86400 IN NSEC some.host. SOA RRSIG NSEC DNSKEY
some.host.              86400 IN RRSIG NSEC 13 2 86400 (
                                20171019000000 20170928000000 59581 some.host.
                                4fjlTftqvjmoH0OwVf3uuC8OvvuYyyIckn+c5L0J89Np
                                kc1+LCZ5DJpQrnbsWypxr5bDXARB86pr046dbrs21A== )
</code></pre><ul><li>使用在线工具检验 DNSSEC</li></ul><p>打开网页 <a href=https://dnssec-debugger.verisignlabs.com target=_blank>https://dnssec-debugger.verisignlabs.com</a></p><p>输入域名 some.host</p><h2 id=参考资料>参考资料</h2><ul><li>[How To Install and Configure PowerDNS with a MariaDB Backend on Ubuntu 14.04] (<a href=https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-powerdns-with-a-mariadb-backend-on-ubuntu-14-04 target=_blank>https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-powerdns-with-a-mariadb-backend-on-ubuntu-14-04</a>
)</li><li><a href=https://github.com/ngoduykhanh/PowerDNS-Admin/wiki/Running-PowerDNS-Admin-on-Ubuntu-16.04---Ubuntu-18.04 target=_blank>Running PowerDNS Admin on Ubuntu 16.04 Ubuntu 18.04</a></li><li><a href=https://github.com/ngoduykhanh/PowerDNS-Admin/wiki/Using-PowerDNS-Admin-with-PostgreSQL target=_blank>Using PowerDNS Admin with PostgreSQL</a></li><li>官方安装文档 <a href=https://doc.powerdns.com/authoritative/installation.html target=_blank>https://doc.powerdns.com/authoritative/installation.html</a></li><li><a href=https://www.claudiokuenzler.com/blog/844/powerdns-master-slave-dns-replication-mysql-backend target=_blank>PowerDNS Master Slave DNS Replication with MySQL backend</a></li></ul><h2 id=vps-推荐>VPS 推荐</h2><ul><li>[10g.biz] (<a href="https://10g.biz/aff.php?aff=226" target=_blank>https://10g.biz/aff.php?aff=226</a>
)</li><li>[bandwagonhost 中国优化] (<a href="https://bandwagonhost.com/aff.php?aff=20451" target=_blank>https://bandwagonhost.com/aff.php?aff=20451</a>
)</li><li>[cubecloud] (<a href="https://www.cubecloud.net/aff.php?aff=963" target=_blank>https://www.cubecloud.net/aff.php?aff=963</a>
)</li></ul></div><div class="post-copyright mb-4"><h3>版权</h3><div class=post-cc>本作品采用 <a target=_blank rel=license href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh>CC BY-NC-ND 4.0 <i class="fab fa-fw fa-creative-commons"></i><i class="fab fa-fw fa-creative-commons-by"></i><i class="fab fa-fw fa-creative-commons-nc"></i><i class="fab fa-fw fa-creative-commons-nd"></i></a> 授权。</div></div><hr><div class="post-navs d-flex mb-3 justify-content-between"><div class="post-nav w-50"><div class="prev-post btn btn-sm"><a href=https://windyboy.github.io/zh-cn/zh-cn/posts/tech/setup-powerdns-authoritative-with-dnssec/>使用powerdns搭建自己安全的域名解析服务</a></div></div><div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm"><a href=https://windyboy.github.io/zh-cn/zh-cn/posts/tech/proxy-with-nghttpx-squid/>nghttpx搭配squid科学浏览（更新debian）</a></div></div></div><section class=related-posts><h3>相关文章</h3><ul class=related-posts><li><a href=https://windyboy.github.io/zh-cn/zh-cn/posts/tech/setup-powerdns-authoritative-with-dnssec/>使用powerdns搭建自己安全的域名解析服务</a></li><li><a href=https://windyboy.github.io/zh-cn/zh-cn/posts/tech/tomcat-keystore-using-letsencrypt-certs/>tomcat 以 keystore 的方式使用 letsencrypt 证书</a></li><li><a href=https://windyboy.github.io/zh-cn/posts/tech/tomcat-keystore-using-letsencrypt-certs/>tomcat 以 keystore 的方式使用 letsencrypt 证书</a></li></ul></section></article><div class="post-comments surface row"><div id=remark42></div><script>var remark_config={host:"https://remark.windy.me",site_id:"backyard",url:"https://windyboy.github.io/zh-cn/posts/tech/setup-powerdns-authoritative-with-dnssec/",locale:"zh",theme:"dark"};(function(e){for(t=0;t<e.length;t++){var t,n=document,s=n.createElement("script");s.src=remark_config.host+"/web/"+e[t]+".js",s.defer=!0,(n.head||n.body).appendChild(s)}})(remark_config.components||["embed"])</script></div></div></div><aside class="col-lg-4 sidebar d-flex"><div class=container><section class="profile surface row"><div class="col-xl-6 d-flex align-items-center justify-content-center"><img class="profile-avatar img-fluid" src=https://windyboy.github.io/images/profile.webp alt=糖醋小排 loading=lazy></div><div class=col-xl-6><h5 class="profile-name my-2">糖醋小排</h5><div class="profile-bio mb-2">编程 自行车 玩</div><div class="profile-company mb-2"><i class="fas fa-fw fa-building"></i>Null</div><div class="profile-location mb-2"><i class="fas fa-fw fa-map-marker-alt"></i>广州</div></div></section><section class="recent-posts row surface"><h4>最近文章</h4><ul><li><a href=https://windyboy.github.io/zh-cn/posts/tech/write_native_graphql_client_mutation/>使用go的graphql本地客户端mutation</a></li><li><a href=https://windyboy.github.io/zh-cn/posts/tech/urfave-cli-read-config-file/>Urfave Cli 从配置文件读取参数</a></li><li><a href=https://windyboy.github.io/zh-cn/posts/tech/drone-ci-x509-issue/>Drone CI 解决自签名证书的信任问题</a></li><li><a href=https://windyboy.github.io/zh-cn/posts/tech/setup-remark42/>使用 Remark42 实现自建用户留言</a></li><li><a href=https://windyboy.github.io/zh-cn/posts/tech/kind-add-self-signed-ca/>Kind添加私有仓库自签名CA证书</a></li></ul></section><section class="taxonomy-categories row surface"><h4><a href=https://windyboy.github.io/zh-cn/categories>分类</a></h4><div><a href=https://windyboy.github.io/zh-cn/categories/%E6%8A%80%E6%9C%AF/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=技术>技术 <span class="badge rounded-pill">16</span></a></div></section><section class="taxonomy-tags row surface"><h4><a href=https://windyboy.github.io/zh-cn/tags>标签</a></h4><div><a href=https://windyboy.github.io/zh-cn/tags/golang/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=golang>golang <span class="badge rounded-pill">4</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/x509/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=x509>x509 <span class="badge rounded-pill">4</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/authoritative/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=authoritative>authoritative <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/ca/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=ca>ca <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/certificate/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=certificate>certificate <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/cli/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=cli>cli <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/cloudxns/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=cloudxns>cloudxns <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/comments/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=comments>comments <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/config/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=config>config <span class="badge rounded-pill">2</span>
</a><a href=https://windyboy.github.io/zh-cn/tags/devops/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=devops>devops <span class="badge rounded-pill">2</span></a></div></section></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"><li class=nav-item><a class="nav-link social-link" href=mailto:windyboy@gmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://github.com/windyboy title=GitHub><i class="fa-fw fa-2x fab fa-github"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://www.reddit.com/user/windysylph title=Reddit><i class="fa-fw fa-2x fab fa-reddit"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://twitter.com/windysylph title=Twitter><i class="fa-fw fa-2x fab fa-twitter"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://weibo.com/windysylph title=Weibo><i class="fa-fw fa-2x fab fa-weibo"></i></a></li></nav><div class="copyright mb-2">© 2016-2022 糖醋小排 版权所有.</div><div class="powered-by mb-2">Powered by <a href=https://gohugo.io target=_blank>Hugo</a> and the <a href=https://github.com/razonyang/hugo-theme-bootstrap target=_blank>Bootstrap</a> theme.</div></footer><a id=btnScrollToTop class=btn-scroll-to-top><i class="fas fa-fw fa-chevron-circle-up fa-2x"></i></a></body></html>